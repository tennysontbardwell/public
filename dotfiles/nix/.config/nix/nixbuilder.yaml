arch: "aarch64"

cpus: 6
memory: "12GiB"
disk: "80GiB"

# Ubuntu cloud image (ARM64). Pick whatever distro you prefer.
images:
  - location: "https://cloud-images.ubuntu.com/releases/24.04/release/ubuntu-24.04-server-cloudimg-arm64.img"
    arch: "aarch64"

ssh:
  forwardAgent: true

mounts:
  # Optional: mount your repo read-only
  - location: "~/repos/tennysontbardwell/public/dotfiles/nix/.config/nix/"
    mountPoint: "/mnt/src"
    writable: false

  # Optional: mount an output/artifacts directory read-write
  - location: "~/excluded-backup/nix-artifacts"
    mountPoint: "/mnt/out"
    writable: true

provision:
  - mode: system
    script: |
      set -eux
      apt-get update
      apt-get install -y curl xz-utils ca-certificates openssh-client
  - mode: user
    script: |
      set -eux
      sh <(curl -L https://nixos.org/nix/install) --no-daemon
      mkdir -p ~/.config/nix
      cat > ~/.config/nix/nix.conf <<'EOF'
      experimental-features = nix-command flakes
      EOF
      . "$HOME/.nix-profile/etc/profile.d/nix.sh"
      nix --version
